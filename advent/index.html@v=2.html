<!DOCTYPE html>
<html lang="hu" class="no-js">

<head>
<meta charset="utf-8">
<title>InfoC :: Adventi naptár</title>
<meta property="og:title" content="InfoC :: Adventi naptár">
<meta property="og:image" content="/modulz/logo.png">
<meta property="og:description" content="InfoC :: Adventi naptár">
<meta property="og:site_name" content="InfoC – Programozás alapjai I.">
<meta name="description" content="InfoC :: Adventi naptár">
<meta name="keywords" content="bme eet infoc programozás prog1 szoftlab1">
<meta name="robots" content="noarchive">
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="shortcut icon" href="../modulz/favicon.ico" id="faviconhref">
<link rel="apple-touch-icon" href="../modulz/logo_touch.png">
<link rel="image_src" href="../modulz/logo.png"> 
<script>var infoc = { onloads: [], onresize: [] };</script>
<link rel="stylesheet" href="../modulz/style/style-vik.css@v10.css">
<link rel="stylesheet" href="../modulz/style/localfonts.css@v10.css">
<script src="../modulz/siteui.js@v10" async></script>
</head>

<body class="doksibody">
<!--[if lt IE 9]>
<blockquote><p>A régi Internet Explorer böngésző, amit használsz, nem támogatott!
Az oldal használatához keress egy <a href="http://browsehappy.com/">jobb, újabb böngészőprogramot</a>!</p></blockquote>
<![endif]-->
<div id="bodycontent">

<nav role="navigation">
<div id="menubg">
<div id="menu" class="shaper dropdown">
<div class="infoc"><a href="../index.html">InfoC</a></div>
<ul>
<li class="al "><a href="index.html@v=2.html#" onclick="menu_click(this)">Infó</a>
<ul>
<li><a href="../index.html">Kezdőlap</a>
<li><a href="../nhf.html">Nagy házi feladat</a>
<li><a href="../elerhetoseg.html">Elérhetőség</a>
</ul>

<li class="al "><a href="index.html@v=2.html#" onclick="menu_click(this)">Tananyag</a>
<ul>
<li class="al "><a href="index.html@v=2.html#" onclick="menu_click(this)">Előadás</a>
<ul>
<li><a href="../ea01.html">1. hét: bevezetés</a>
<li><a href="../ea02.html">2. hét: algoritmusok</a>
<li><a href="../ea03.html">3. hét: tételek, tömbök</a>
<li><a href="../ea04.html">4. hét: függvények, számábrázolás</a>
<li><a href="../ea05.html">5. hét: operátorok, struktúrák</a>
<li><a href="../ea06.html">6. hét: pointerek, állapotgépek</a>
<li><a href="../ea07.html">7. hét: rendezések, rekurzió</a>
<li><a href="../ea08.html">8. hét: dinamikus memóriakezelés</a>
<li><a href="../ea09.html">9. hét: láncolt listák</a>
<li><a href="../ea11.html">11. hét: fájlkezelés, modulok</a>
<li><a href="../ea12.html">12. hét: bináris fák</a>
<li><a href="../ea13.html">13. hét: generikus algoritmusok</a>
<li><a href="../ea14.html">14. hét: nagy program tervezése</a>
</ul>

<li class="al "><a href="index.html@v=2.html#" onclick="menu_click(this)">Gyakorlat</a>
<ul>
<li><a href="../gy01.html">1. hét: tanult algoritmusok</a>
<li><a href="../gy02.html">2. hét: algoritmizálás</a>
<li><a href="../gy03.html">3. hét: egyszerű programok</a>
<li><a href="../gy04.html">4. hét: tételek és tömbök</a>
<li><a href="../gy05.html">5. hét: függvények</a>
<li><a href="../gy06.html">6. hét: származtatott típusok</a>
<li><a href="../gy07.html">7. hét: mutatók használata</a>
<li><a href="../gy08.html">8. hét: rekurzió, állapotgép</a>
<li><a href="../gy09.html">9. hét: dinamikus tömbök</a>
<li><a href="../gy11.html">11. hét: láncolt listák I.</a>
<li><a href="../gy12.html">12. hét: láncolt listák II.</a>
<li><a href="../gy13.html">13. hét: bináris fák</a>
<li><a href="../gy14.html">14. hét: generikus algoritmusok</a>
</ul>

<li class="al "><a href="index.html@v=2.html#" onclick="menu_click(this)">Labor</a>
<ul>
<li><a href="../lab01.html">1. hét: operációs rendszer</a>
<li><a href="../lab02.html">2. hét: fejlesztőkörnyezet használata</a>
<li><a href="../lab03.html">3. hét: egyszerű programok</a>
<li><a href="../lab04.html">4. hét: tömbök</a>
<li><a href="../lab06.html">6. hét: struktúrák és függvények</a>
<li><a href="../lab06sz.html">6. hét, szombat: gyakorlófeladatok</a>
<li><a href="../lab08.html">8. hét: mutatók, sztringek</a>
<li><a href="../lab09.html">9. hét: dinamikus tömbök</a>
<li><a href="../lab10.html">10. hét: rekurzió és állapotgépek</a>
<li><a href="../lab11.html">11. hét: láncolt listák</a>
<li><a href="../lab12.html">12. hét: duplán láncolt listák</a>
<li><a href="../lab13.html">13. hét: bináris fák</a>
<li><a href="../lab14.html">14. hét: labirintus játék</a>
</ul>

<li class="al "><a href="index.html@v=2.html#" onclick="menu_click(this)">Példatár</a>
<ul>
<li><a href="../f01.html">1. hét: egyszerű programok</a>
<li><a href="../f02.html">2. hét: vezérlési szerkezetek</a>
<li><a href="../f03.html">3. hét: logika, sorozatok, tömbök</a>
<li><a href="../f04.html">4. hét: számábrázolás, bitek, függvények</a>
<li><a href="../f05.html">5. hét: operátorok, struktúrák</a>
<li><a href="../f06.html">6. hét: pointerek, sztringek, állapotgépek</a>
<li><a href="../f07.html">7. hét: rendezések, rekurzió</a>
<li><a href="../f08.html">8. hét: dinamikus memóriakezelés</a>
<li><a href="../f09.html">9. hét: láncolt listák</a>
<li><a href="../f11.html">11. hét: parancssor, fájlkezelés, modulok</a>
<li><a href="../f12.html">12. hét: bináris fák, többszörös indirekció</a>
<li><a href="../f13.html">13. hét: generikus algoritmusok</a>
</ul>

</ul>

<li class="al "><a href="index.html@v=2.html#" onclick="menu_click(this)">Segédlet</a>
<ul>
<li><a href="../jegyzet.html">Jegyzet és puska</a>
<li><a href="../fejlesztokornyezet.html">Fejlesztőkörnyezetek</a>
<li><a href="../stilus.html">Kódolási stílus</a>
<li><a href="../tanacsok.html">Tanácsok a tanuláshoz</a>
<li><a href="../debugmalloc.html">Debugmalloc</a>
<li><a href="../mintanhf.html">NHF minta</a>
</ul>

<li class="al "><a href="index.html@v=2.html#" onclick="menu_click(this)">Extrák</a>
<ul>
<li class="al "><a href="index.html@v=2.html#" onclick="menu_click(this)">Szorgalmik, versenyek</a>
<ul>
<li><a href="../nhfszepsegverseny2014.html">NHF szépségverseny 2014</a>
<li><a href="../nhfszepsegverseny2013.html">NHF szépségverseny 2013</a>
<li><a href="../nhfszepsegverseny2012.html">NHF szépségverseny 2012</a>
<li><a href="../orak.html">SVG óra galéria</a>
<li><a href="../angrybirds.html">SVG Angry Birds</a>
</ul>

<li class="al "><a href="index.html@v=2.html#" onclick="menu_click(this)">Elmélet</a>
<ul>
<li><a href="../turing.html">Mit tud a számítógép?</a>
<li><a href="../bf.html">BF</a>
<li><a href="../bitturmix.html">Bitturmix</a>
<li><a href="../labirintus.html">Labirintusok</a>
<li><a href="../tripla.html">Tripla indirekció</a>
</ul>

<li class="al "><a href="index.html@v=2.html#" onclick="menu_click(this)">Gyakorlat</a>
<ul>
<li><a href="../karakterkodolas.html">Karakterkódolások</a>
<li><a href="../strlcpy.html">Kulturált sztringmásoló</a>
<li><a href="../internet.html">Internet</a>
</ul>

<li class="al "><a href="index.html@v=2.html#" onclick="menu_click(this)">Grafika</a>
<ul>
<li><a href="../sdl.html">SDL grafika</a>
<li><a href="../sdl_telepito.html">SDL telepítés</a>
<li><a href="../fa.html">Fák rajzolása</a>
<li><a href="../lathatatlan.html">Láthatatlan zongorista</a>
</ul>

<li class="al "><a href="index.html@v=2.html#" onclick="menu_click(this)">Nyelvészet</a>
<ul>
<li><a href="../mondatelemzo.html">Mondatelemző</a>
<li><a href="../kifejezesek.html">Kifejezések</a>
<li><a href="../derivalas.html">Deriválás</a>
<li><a href="../ast_epit.html">AST: szintaxisfák</a>
<li><a href="../ast_epit_copa.html">AST: értékadás I.</a>
<li><a href="../ast_epit_parameteres.html">AST: értékadás II.</a>
</ul>

<li><a href="../advent.html">Adventi naptár</a>
</ul>

</ul>
</div>
</div>
</nav>

<main role="main">
<div id="doksi" class="shaper">
<section id="0">
<div class="slide" id="slide_0">
<div class="float" style="margin-top: 0.25em; margin-bottom: 0;"><a href="../advent.html">&larr; vissza</a></div>
<h1 class="eloadascim">Adventi naptár</h1>
<h2>A Mandelbrot-halmaz</h2>

<nav><div id="tartalom">
<h3>Tartalom</h3>
<ol>
<li><a href="index.html@v=2.html#1">A Mandelbrot-halmaz</a>
<li><a href="index.html@v=2.html#2">Nagyítás</a>
</ol>
</div>
</nav>
</div>
</section>
<section id="1">
<div class="slide" id="slide_1">
<div class="slideheader">
<h2><span class="oldalszam">1</span>A Mandelbrot-halmaz</h2>
</div>
<img src="advent2-mandelbrot.png" class="float arnyek">

<p>Többé-kevésbé pontosan idézve a Wikipediáról:
a <a href="http://hu.wikipedia.org/wiki/Mandelbrot-halmaz">Mandelbrot-halmaz</a> azon komplex számokból áll, 
amelyekre a következő, rekurzívan definiált sorozat nem tart a végtelenbe:

<div class="kozep">
z<sub>0</sub>=0
<br>
z<sub>n+1</sub>=z<sub>n</sub><sup>2</sup>+c
</div>


<p>Ezt a halmazt a kétdimenziós komplex számsíkon szokták ábrázolni; a képletben <i>c</i> az 
adott pont koordinátája. A dolog érdekessége, hogy a keletkező ábra részletessége végtelen nagy. 
Bármekkora nagyítással találhatók benne olyan részek, amelyek hasonlítanak a teljes halmaz 
formájára. Vagyis bármeddig nagyíthatjuk, soha nem érjük el a maximális nagyítást.

<p>Írjunk programot, amely kirajzolja ezt a halmazt! A fenti, komplex számokon végzett 
műveleteket ehhez le kell írnunk valós számokkal. Felbontva valós és képzetes részre a számot:
<i>z=z<sub>r</sub>+jz<sub>i</sub></i>, a következő egyenletrendezés adódik. Az utolsó sorban külön 
látható az új <i>z</i> érték valós és képzetes része.

<div class="kozep" style="line-height: 2">
z<sub>új</sub>=z<sup>2</sup>+c
<br>
z<sub>új</sub>=(z<sub>r</sub>+jz<sub>i</sub>)<sup>2</sup>+c<sub>r</sub>+jc<sub>i</sub>
<br>
z<sub>új</sub>=z<sub>r</sub><sup>2</sup>+2jz<sub>r</sub>z<sub>i</sub>+j<sup>2</sup>z<sub>i</sub><sup>2</sup>+c<sub>r</sub>+jc<sub>i</sub>
<br>
z<sub>új</sub>=z<sub>r</sub><sup>2</sup>-z<sub>i</sub><sup>2</sup>+c<sub>r</sub> + j(2z<sub>r</sub>z<sub>i</sub>+c<sub>i</sub>)
</div>

<p>Mit jelent az, hogy nem tart végtelenbe a sorozat? Ez programozásilag nem igazán megfogható 
fogalom, ugyanis nem tehetjük meg, hogy egy végtelenségig futó ciklust írunk ennek tesztelésére. 
A számítást ezért úgy kell végezni, hogy ellenőrizzük, <i>z</i> értékének abszolút értéke kisebb-
e kettőnél (ha nagyobb, akkor a négyzetre emelés miatt úgyis biztosan egyre nagyobb lesz, hiszen 
a szorzás egy nagyításnak felel meg); illetve számoljuk, hogy a sorozat hányadik értékét 
határoztuk meg. Egy adott iterációszám felett a ciklust megszakítjuk. A |<i>z</i>|&lt;<i>2</i> 
egyenlőtlenség valós számokkal <code>sqrt(zr*zr+zi*zi)&lt;2</code>-nek felel meg; mivel a 
négyzetgyök szigorúan monoton függvény, ezt érdemes a kódban <code>zr*zr+zi*zi&lt;4</code>-re 
átírni, mert a gyökvonást meg lehet ezáltal spórolni. A számítás így néz ki:

<pre class="brush: c "  >
for (y=0; y&lt;MERETY; y++) {
   for (x=0; x&lt;MERETX; x++) {
      /* a konstanst a koordinata hatarozza meg */
      double cr=(x-MERETX/2)/(double)MERETX*4;
      double ci=(y-MERETY/2)/(double)MERETY*4;
      double zr=0, zi=0;

      /* addig, amig |z|&lt;2, vagy tul sok iteracio nem volt */
      i=0;
      while (i&lt;128 &amp;&amp; zr*zr+zi*zi&lt;4) {
         /* ez itt a z=z^2+c */
         double uzr=zr*zr-zi*zi+cr;
         double uzi=2*zr*zi+ci;  /* http://napirajz.hu/wp-content/uploads/zsak.jpg */
         zr=uzr;
         zi=uzi;
         i++;
      }
      /* az iteraciok szama hatarozza meg a keppont szinet: i */
   }
}</pre>

<p>A fenti, színes ábrák úgy alakulnak ki, hogy az iterációk számához, azaz az <code>i</code> 
értékéhez rendelünk színeket. Az egymás utáni színeket érdemes úgy beállítani, hogy átmenet 
legyen közöttük. Ezt csinálják a letölthető kódban a <code>szinek()</code> és a
<code>gradient()</code> függvények. A színeket egy táblázatból olvassuk ki. A <code>szinek()</code> függvény 
ezt a táblázatot alkotja meg – a megadott vörös, zöld, kék (0…255) komponensek között egyenes 
átmenetet képezve.

<p>A program: <a href="advent2-mandelbrot.c">advent2-mandelbrot.c</a>.




</div>
</section>
<section id="2">
<div class="slide" id="slide_2">
<div class="slideheader">
<h2><span class="oldalszam">2</span>Nagyítás</h2>
</div>


<p>Mindez persze nem túl izgalmas addig, amíg nem tudjuk nagyítani a képet, és nem tudunk
navigálni rajta. Ezért a program második változatába bekerültek ezek a lehetőségek. A
programba bekerült az x/y irányú eltolás, és a nagyítás értékét tároló változó:</p>

<pre class="brush: c "  >
double ex = 0, ey = 0, n = screen-&gt;w/4.0;  /* eltolas es nagyitas */</pre>

<p>Ezek értékét pedig a kurzorbillentyűk, továbbá a <kbd>Q</kbd> és <kbd>A</kbd> billentyűk hatására úgy
változtatjuk, hogy a kép mozogjon, továbbá a nagyítást a kép középpontjához képest
végezzük:</p>

<pre class="brush: c "  >
if (keystate[SDLK_UP]) { ey -= 2; rajzol = 1; }
if (keystate[SDLK_DOWN]) { ey += 2; rajzol = 1; }
if (keystate[SDLK_RIGHT]) { ex += 2; rajzol = 1; }
if (keystate[SDLK_LEFT]) { ex -= 2; rajzol = 1; }
if (keystate[SDLK_q]) { n *= 1.01; ex *= 1.01; ey *= 1.01; rajzol = 1; }
if (keystate[SDLK_a]) { n /= 1.01; ex /= 1.01; ey /= 1.01; rajzol = 1; }</pre>

<img src="advent2-julia.png" class="float arnyek">

<p>&hellip; és már jók is vagyunk. Csak a program kicsit lassúcska néha, ha olyan területek
felé navigálunk, ahol túl nagy iterációszámra van szükség. De nem gond – meg kell izzasztani
a gépet! A mai processzorok kettő vagy négy magosak is lehetnek, ami azt jelenti, hogy a
számításokat szétoszthatjuk a magok között. Mivel az egyes képpontokhoz tartozó számítások
egymástól függetlenek, ez könnyen megy: egyik képpontot (vagy egyik sor képpontjait) számolhatja
az egyik mag, a másikét pedig a másik.</p>

<p>Az ilyen jellegű párhuzamosításhoz legjobban az OpenMP használható. Ha a fordítónk ezt 
támogatja, akkor ezzel megoldható, hogy egy kiválasztott ciklus egyes iterációit szétosszuk a 
rendelkezésre álló processzormagok között. Aki több processzorral vagy processzormaggal 
rendelkező gépen próbálja ki a programot (pl. egy Core2Duo-s gépen), így sokkal gyorsabb 
animációt kaphat. Az alábbi direktívát írva a <code>for()</code> ciklus elé azt mondjuk
az OpenMP-nek, hogy ennek a ciklusnak az iterációit nyolcasával ossza szét a magok között:

<pre class="brush: c "  >
#pragma omp parallel for schedule(dynamic, 8)
for (y=0; y&lt;MERETY; y++) …</pre>

<p>Párhuzamosításkor figyelni kell arra, hogy a program több szálon fut. A szálak memóriája, 
vagyis a változók viszont közösek. Ez olyan, mintha egyszerre két program férne hozzá a 
változókhoz, vagyis akár felül is írhatják egymás értékeit. Mivel az egyes sorok oszlop szerinti 
ciklusai eltérő helyen tarthatnak, ez azt jelenti, hogy az egyes szálak különböző <code>x</code> 
változókkal kell rendelkezzenek. A cikluson kívül deklarált változók az OpenMP használatakor úgy 
viselkednek, mintha globális változók lennének. Ha így használjuk az <code>x</code> változót, 
helytelen eredményt kapunk. Viszont ha a cikluson belül deklaráljuk azokat a változókat, 
amelyekből független példányoknak kell lenniük (jelen esetben az <code>x</code>-et és az 
<code>i</code>-t), akkor a szálokon belül lokálissá válnak:

<pre class="brush: cbub "  >
#pragma omp parallel for schedule(dynamic, 8)
for (y=0; y&lt;MERETY; y++) {
   int x; // minden szálnak saját
   for (x=0; x&lt;MERETX; x++) …</pre>

<p>A letölthető program: <a href="advent2-zoomer.c">advent2-zoomer.c</a>.
Az OpenMP engedélyezéséhez a GCC fordítónál az <code>-fopenmp</code> paraméterre van
szükség (Code::Blocks: Project, Build Options, balra fent: project neve, Compiler
settings, Other options: <code>-fopenmp</code>), továbbá érdemes az optimalizálást
is engedélyezni: Compiler settings, Compiler flags, Optimize fully (for speed): <code>-O3</code>,
mert ettől is legalább duplájára gyorsul.

<p class="megjegyzes">Az OpenMP-t a GCC fordítónak nem minden verziója támogatja; így
előfordulhat, hogy ez nem fog működni minden GCC/CodeBlocks kombóval.</p>

<p>A Julia-halmaz a fentihez nagyon hasonló. A különbség annyi, hogy a <i>c</i> szám a 
számításban konstans, nem a koordináta határozza meg; helyette <i>z</i> kezdeti értéke függ a 
koordinátától. Azokra a pontokra, amelyekre <i>c</i> a Mandelbrot-halmazon belüli szám,
a Julia-halmaz látványos formát ölt. Lásd a forráskódot!

</div>
</section>
</div>
</main>

<nav role="navigation">
<a href="index.html@v=2.html#menu" id="scrolltotop"></a>
</nav>

<footer role="contentinfo">
<div id="footer" class="shaper">
<a href="../index.html"><img src="../modulz/logo.png" id="footerlogo" alt="Logo"></a>
<div>InfoC – Programozás alapjai I.</div>
<div class="csakkepernyon"><a href="../index.html">főoldal</a> · <a href="../elerhetoseg.html">elérhetőség</a> · <a href="https://www.facebook.com/infoceetbmehu">facebook</a></div>
<div class="csaknyomtatasban">Kérjük, az oldalak kinyomtatása előtt gondolj a környezetre.</div>
BME EET, 2009-2014.</div>
</footer>

</div>
</body>

</html>
