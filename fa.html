<!DOCTYPE html>
<html lang="hu" class="no-js">

<head>
<meta charset="utf-8">
<title>InfoC :: Fák rajzolása</title>
<meta property="og:title" content="InfoC :: Fák rajzolása">
<meta property="og:image" content="/modulz/logo.png">
<meta property="og:description" content="Különféle fafajtákat kirajzoló program. Éljen a rekurzió!">
<meta property="og:site_name" content="InfoC – Programozás alapjai I.">
<meta name="description" content="Különféle fafajtákat kirajzoló program. Éljen a rekurzió!">
<meta name="keywords" content="bme eet infoc programozás prog1 szoftlab1">
<meta name="robots" content="noarchive">
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="shortcut icon" href="modulz/favicon.ico" id="faviconhref">
<link rel="apple-touch-icon" href="modulz/logo_touch.png">
<link rel="image_src" href="modulz/logo.png"> 
<script>var infoc = { onloads: [], onresize: [] };</script>
<link rel="stylesheet" href="modulz/style/style-vik.css@v10.css">
<link rel="stylesheet" href="modulz/style/localfonts.css@v10.css">
<script src="modulz/siteui.js@v10" async></script>
</head>

<body class="doksibody">
<!--[if lt IE 9]>
<blockquote><p>A régi Internet Explorer böngésző, amit használsz, nem támogatott!
Az oldal használatához keress egy <a href="http://browsehappy.com/">jobb, újabb böngészőprogramot</a>!</p></blockquote>
<![endif]-->
<div id="bodycontent">

<nav role="navigation">
<div id="menubg">
<div id="menu" class="shaper dropdown">
<div class="infoc"><a href="index.html">InfoC</a></div>
<ul>
<li class="al "><a href="fa.html#" onclick="menu_click(this)">Infó</a>
<ul>
<li><a href="index.html">Kezdőlap</a>
<li><a href="nhf.html">Nagy házi feladat</a>
<li><a href="elerhetoseg.html">Elérhetőség</a>
</ul>

<li class="al "><a href="fa.html#" onclick="menu_click(this)">Tananyag</a>
<ul>
<li class="al "><a href="fa.html#" onclick="menu_click(this)">Előadás</a>
<ul>
<li><a href="ea01.html">1. hét: bevezetés</a>
<li><a href="ea02.html">2. hét: algoritmusok</a>
<li><a href="ea03.html">3. hét: tételek, tömbök</a>
<li><a href="ea04.html">4. hét: függvények, számábrázolás</a>
<li><a href="ea05.html">5. hét: operátorok, struktúrák</a>
<li><a href="ea06.html">6. hét: pointerek, állapotgépek</a>
<li><a href="ea07.html">7. hét: rendezések, rekurzió</a>
<li><a href="ea08.html">8. hét: dinamikus memóriakezelés</a>
<li><a href="ea09.html">9. hét: láncolt listák</a>
<li><a href="ea11.html">11. hét: fájlkezelés, modulok</a>
<li><a href="ea12.html">12. hét: bináris fák</a>
<li><a href="ea13.html">13. hét: generikus algoritmusok</a>
<li><a href="ea14.html">14. hét: nagy program tervezése</a>
</ul>

<li class="al "><a href="fa.html#" onclick="menu_click(this)">Gyakorlat</a>
<ul>
<li><a href="gy01.html">1. hét: tanult algoritmusok</a>
<li><a href="gy02.html">2. hét: algoritmizálás</a>
<li><a href="gy03.html">3. hét: egyszerű programok</a>
<li><a href="gy04.html">4. hét: tételek és tömbök</a>
<li><a href="gy05.html">5. hét: függvények</a>
<li><a href="gy06.html">6. hét: származtatott típusok</a>
<li><a href="gy07.html">7. hét: mutatók használata</a>
<li><a href="gy08.html">8. hét: rekurzió, állapotgép</a>
<li><a href="gy09.html">9. hét: dinamikus tömbök</a>
<li><a href="gy11.html">11. hét: láncolt listák I.</a>
<li><a href="gy12.html">12. hét: láncolt listák II.</a>
<li><a href="gy13.html">13. hét: bináris fák</a>
<li><a href="gy14.html">14. hét: generikus algoritmusok</a>
</ul>

<li class="al "><a href="fa.html#" onclick="menu_click(this)">Labor</a>
<ul>
<li><a href="lab01.html">1. hét: operációs rendszer</a>
<li><a href="lab02.html">2. hét: fejlesztőkörnyezet használata</a>
<li><a href="lab03.html">3. hét: egyszerű programok</a>
<li><a href="lab04.html">4. hét: tömbök</a>
<li><a href="lab06.html">6. hét: struktúrák és függvények</a>
<li><a href="lab06sz.html">6. hét, szombat: gyakorlófeladatok</a>
<li><a href="lab08.html">8. hét: mutatók, sztringek</a>
<li><a href="lab09.html">9. hét: dinamikus tömbök</a>
<li><a href="lab10.html">10. hét: rekurzió és állapotgépek</a>
<li><a href="lab11.html">11. hét: láncolt listák</a>
<li><a href="lab12.html">12. hét: duplán láncolt listák</a>
<li><a href="lab13.html">13. hét: bináris fák</a>
<li><a href="lab14.html">14. hét: labirintus játék</a>
</ul>

<li class="al "><a href="fa.html#" onclick="menu_click(this)">Példatár</a>
<ul>
<li><a href="f01.html">1. hét: egyszerű programok</a>
<li><a href="f02.html">2. hét: vezérlési szerkezetek</a>
<li><a href="f03.html">3. hét: logika, sorozatok, tömbök</a>
<li><a href="f04.html">4. hét: számábrázolás, bitek, függvények</a>
<li><a href="f05.html">5. hét: operátorok, struktúrák</a>
<li><a href="f06.html">6. hét: pointerek, sztringek, állapotgépek</a>
<li><a href="f07.html">7. hét: rendezések, rekurzió</a>
<li><a href="f08.html">8. hét: dinamikus memóriakezelés</a>
<li><a href="f09.html">9. hét: láncolt listák</a>
<li><a href="f11.html">11. hét: parancssor, fájlkezelés, modulok</a>
<li><a href="f12.html">12. hét: bináris fák, többszörös indirekció</a>
<li><a href="f13.html">13. hét: generikus algoritmusok</a>
</ul>

</ul>

<li class="al "><a href="fa.html#" onclick="menu_click(this)">Segédlet</a>
<ul>
<li><a href="jegyzet.html">Jegyzet és puska</a>
<li><a href="fejlesztokornyezet.html">Fejlesztőkörnyezetek</a>
<li><a href="stilus.html">Kódolási stílus</a>
<li><a href="tanacsok.html">Tanácsok a tanuláshoz</a>
<li><a href="debugmalloc.html">Debugmalloc</a>
<li><a href="mintanhf.html">NHF minta</a>
</ul>

<li class="al "><a href="fa.html#" onclick="menu_click(this)">Extrák</a>
<ul>
<li class="al "><a href="fa.html#" onclick="menu_click(this)">Szorgalmik, versenyek</a>
<ul>
<li><a href="nhfszepsegverseny2014.html">NHF szépségverseny 2014</a>
<li><a href="nhfszepsegverseny2013.html">NHF szépségverseny 2013</a>
<li><a href="nhfszepsegverseny2012.html">NHF szépségverseny 2012</a>
<li><a href="orak.html">SVG óra galéria</a>
<li><a href="angrybirds.html">SVG Angry Birds</a>
</ul>

<li class="al "><a href="fa.html#" onclick="menu_click(this)">Elmélet</a>
<ul>
<li><a href="turing.html">Mit tud a számítógép?</a>
<li><a href="bf.html">BF</a>
<li><a href="bitturmix.html">Bitturmix</a>
<li><a href="labirintus.html">Labirintusok</a>
<li><a href="tripla.html">Tripla indirekció</a>
</ul>

<li class="al "><a href="fa.html#" onclick="menu_click(this)">Gyakorlat</a>
<ul>
<li><a href="karakterkodolas.html">Karakterkódolások</a>
<li><a href="strlcpy.html">Kulturált sztringmásoló</a>
<li><a href="internet.html">Internet</a>
</ul>

<li class="al "><a href="fa.html#" onclick="menu_click(this)">Grafika</a>
<ul>
<li><a href="sdl.html">SDL grafika</a>
<li><a href="sdl_telepito.html">SDL telepítés</a>
<li><a href="fa.html">Fák rajzolása</a>
<li><a href="lathatatlan.html">Láthatatlan zongorista</a>
</ul>

<li class="al "><a href="fa.html#" onclick="menu_click(this)">Nyelvészet</a>
<ul>
<li><a href="mondatelemzo.html">Mondatelemző</a>
<li><a href="kifejezesek.html">Kifejezések</a>
<li><a href="derivalas.html">Deriválás</a>
<li><a href="ast_epit.html">AST: szintaxisfák</a>
<li><a href="ast_epit_copa.html">AST: értékadás I.</a>
<li><a href="ast_epit_parameteres.html">AST: értékadás II.</a>
</ul>

<li><a href="advent.html">Adventi naptár</a>
</ul>

</ul>
</div>
</div>
</nav>

<main role="main">
<div id="doksi" class="shaper">
<section id="0">
<div class="slide" id="slide_0">
<h1 class="eloadascim">Fák rajzolása</h1>
<div class="focim">
<p class="szerzocim"><i class="szerzo"></i> Czirkos Zoltán · <i class="ido"></i> 2015.02.18 · Frissítve: 2015.02.15</p>
<p class="kivonat">Különféle fafajtákat kirajzoló program. Éljen a rekurzió!</p>
</div>

<p>Az első előadáson szerepelt egy kedvcsináló program, amely különféle alakú
fákat rajzolt ki véletlenszerűen. A rekurziót ismerve ezt megírni már nagyon
egyszerű.</p>

<img src="fa/f1.svg" style="height: 16em;" class="kozep">

<img src="fa/fa_anim.gif" class="float arnyek">

<p>Mert ha fogunk egy függőleges szakaszt (fekete), aztán abból oldalra kiindulva 
rajzolunk két újabb, rövidebb szakaszt, meg fölfelé is egyet (kék)&hellip; Aztán 
az így kapott szakaszokból kiindulva megint rajzolunk szakaszokat (piros), 
amelyek ugyanolyan szögben állnak az előzőekhez képest, mint az az elsőhöz;
aztán meg az ekkor kapottakból ugyanúgy (zöld) és így tovább&hellip; Akkor
kapunk egy fát. Itt a jobb oldali rajzon egy kék–piros–zöld mini fa pont úgy néz ki,
mint a tőle eggyel balra lévő piros–kék–fekete fa, csak kisebb.</p>

<p>Ha mindezt úgy csináljuk, hogy a kiinduló vonal még vastagabb legyen, utána egyre
vékonyabb vonalakat rajzoljunk; a kiinduló vonal még barna legyen, utána egyre zöldebb
vonalakat rajzolunk, akkor már kész is van a fánk. Csak tovább kell vinni a rajzolást,
nem 3 lépésben rajzolni az ágakat, hanem mondjuk 8-10 lépésben, és akkor tényleg fa lesz,
nem pedig antenna.</p>


<p>A fát rajzoló függvény nagyon egyszerű. Kap egy képernyőkoordinátát, ami a fa törzsének 
kiindulópontja. Kap ezen kívül egy szöget, továbbá egy hosszt. Ez egyértelműen meghatározza a 
törzs helyzetét. Megrajzolja a törzset egy szakasszal. Utána pedig fogja az ágak tömbjét, és 
meghívja újra saját magát: de eltérő koordinátákkal (mert a törzs valamely pontjáról indul ki az 
ág), eltérő szöggel (mert valamerre nő az ág a törzshöz képest), és kisebb hosszal (mert az ágak 
egyre rövidebbek). A rekurziót az <code>n</code> paraméter csökkenése állítja meg. Így:</p>

<pre>
FÜGGVÉNY fát_rajzol(n, x, y, szög, hossz, ágak)
        HA n&lt;0, VÉGE
        szakasz(x,y-ból, adott hosszal és szögben)
        CIKLUS végig az ágakon
                fát_rajzol(n-1, x+eltérés, y+eltérés, szög+elhajlás, hossz/rövidülés, ágak)
        CIKLUS vége
FÜGGVÉNY vége
</pre>

<p>A fák változatosságát az ágak paraméterei adják. Ha nagy szögben hajlanak el, terebélyes
fát kapunk, ha kicsiben, inkább magasat. Ha az ágak aljáról indítjuk az elágazásokat, bokrokat
rajzol a program. Ha gyorsan rövidülnek az ágak (a „szülő” águkhozképest), akkor facsemetéket
kapunk. Az egyes ágak tulajdonságait ezért eltároljuk egy struktúrában:</p>

<pre class="brush: c "  >
typedef struct AgAdat {
    double doles;       /* merre dől az eredeti ághoz képest (radián) */
    double helyzet;     /* honnan indul ki (0 = legalul, 1 = legfelül) */
    double rovidules;   /* mennyit rövidül (0 = semennyit, 1 = lenullázódik) */
} AgAdat;</pre>

<p>Minden ágból három másikat indítunk ki, egyet balra, egyet felfelé, egyet pedig jobbra (tehát
a szögeket így kell majd beállítani). A rajzoló függvény az ágak tömbjét fogja átvenni. További
változatosságot lehet bevinni a fák színének beállításával, az egyes ágak dőlésszögének kisebb
véletlenszerű módosításaival és így tovább. Hogy a sok véletlenszámot és lehetséges számtartományt
könnyen tudjuk kezelni, érdemes egy intervallumot megadó típust is létrehozni, és egy olyat átvevő
véletlenszám-generátor függvényt írni:</p>

<pre class="brush: c "  >
typedef struct Intervallum {
    double min, max;
} Intervallum;

double myrand(Intervallum i) {
    double rand1 = rand() / (double) RAND_MAX;  /* ez 0 és 1 között lesz */
    return i.min + (i.max-i.min)*rand1;         /* beskálázva min és max közé */
}</pre>

<p>Ezt használja a fentebb bemutatott pszeudokódot megvalósító, fát rajzoló 
függvény. Ebben átveszünk egy átlátszóság és egy zöld szín és egy sugár 
paramétert is. Az átlátszóság 1-től indulva csökken: a magasabban lévő ágak, 
levelek halványabbak. A sugár úgyszintén csökken a rekurzió mélységével (tehát a 
kisebb ágak felé). A zöld szín egy kívülről érkező adat: 1 a legélénkebb zöld, a 
kisebb számok sötétebb leveleket eredményeznek.</p>

<pre class="brush: c "  >
void fat_rajzol(SDL_Surface *screen, AgAdat agak[], int agszam, int n,
                double x, double y,
                double hossz, double szog,
                double atlatszosag, double zold, double r)
{
    if (n &lt; 0)
        return;
    int atlb = atlatszosag * 255.0, vorosb = atlb * 2/3,
        zoldb = (0xFF-atlb) * (zold + myrand(szinfuzzy));
    myline(screen, x, y, x+hossz*cos(szog), y-hossz*sin(szog),
           vorosb&lt;&lt;24 | zoldb&lt;&lt;16 | 0&lt;&lt;8 | atlb&lt;&lt;0, r);
    for (int i = 0; i &lt; agszam; ++i) {
        fat_rajzol(screen, agak, agszam, n-1,
                   x + hossz*agak[i].helyzet*cos(szog), y - hossz*agak[i].helyzet*sin(szog),
                   hossz * (1-agak[i].rovidules), szog + agak[i].doles + myrand(dolesrand),
                   atlatszosag * 0.8, zold, r * 0.88);
    }
}</pre>

<img src="fa/kepkoord.svg" class="float" style="width: 12em;">

<p>Ebben az ág hosszúságának és szögének függvényében kiszámítjuk az új koordinátákat. Csak
arra kell figyelni, hogy matematikailag az <code>y</code> tengelyen a pozitív előjel
felfelé elmozdulást jelent, a képernyőn lefelé elmozdulást, ezért kapunk egy negatív előjelet.</p>

<p>A fa rajzolása közben a törzs barnájától a levelek zöldjéig egy színátmenetet
kell létrehozni. Ezt is az átlátszóság paraméter segítségével érjük el: ahogy az
átlátszóság csökken, úgy csökken a szín vörös(-es barnás) komponense, és úgy erősödik
a zöld komponense. Ezt állítják be a <code>vorosb</code> és <code>zoldb</code> bájtok,
amelyekből a <code>myline()</code> függvény paramétereként megszületik a <code>0xRRGGBBAA</code>
alakú, 32 bites színkód. A <code>myline()</code> függvény egy adott vastagságú szakaszt
rajzol – azért volt rá szükség, mert az SDL_gfx hasonló célú függvénye hibás. (Legalábbis
azé a verzióé, amelyikkel próbáltam.)</p>

<p>A paraméterek hatása a fa alakjára:</p>

<img src="fa/fa_doles.png" class="kozep arnyek">
<div class="kozep">dőlés = 0.2, 0.35, 0.6</div>

<img src="fa/fa_helyzet.png" class="kozep arnyek">
<div class="kozep">helyzet = 0.15, 0.5, 0.85</div>

<img src="fa/fa_rovidules.png" class="kozep arnyek">
<div class="kozep">rövidülés = 0.2, 0.35, 0.5</div>

<img src="fa/fa_dolesrand.png" class="kozep arnyek">
<div class="kozep">dőlésrand = 0, &plusmn;0.1, &plusmn;0.2</div>

<p>A teljes program letölthető innen:
<a href="fa/fa.c">fa.c</a>.
A működés egy-két további részletével kapcsolatban lásd a forráskód kommentjeit!
Feladat: átírni a programot úgy, hogy egyesével rajzolódjanak ki a szintek, mint
a fenti animációban. Vigyázat, át kell gondolni!</p>

<nav><div id="tartalom"></div></nav>
</div>
</section>
</div>
</main>

<nav role="navigation">
<a href="fa.html#menu" id="scrolltotop"></a>
</nav>

<footer role="contentinfo">
<div id="footer" class="shaper">
<a href="index.html"><img src="modulz/logo.png" id="footerlogo" alt="Logo"></a>
<div>InfoC – Programozás alapjai I.</div>
<div class="csakkepernyon"><a href="index.html">főoldal</a> · <a href="elerhetoseg.html">elérhetőség</a> · <a href="https://www.facebook.com/infoceetbmehu">facebook</a></div>
<div class="csaknyomtatasban">Kérjük, az oldalak kinyomtatása előtt gondolj a környezetre.</div>
BME EET, 2009-2014.</div>
</footer>

</div>
</body>

</html>
